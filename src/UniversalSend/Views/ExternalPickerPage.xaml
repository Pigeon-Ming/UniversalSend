<Page
    x:Class="UniversalSend.Views.ExternalPickerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:UniversalSend.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:storage="using:Windows.Storage" xmlns:models="using:UniversalSend.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <Grid>
            <CommandBar DefaultLabelPosition="Right">
                <CommandBar.Content>
                    <CommandBar DefaultLabelPosition="Right">
                        <CommandBar.PrimaryCommands>
                            <AppBarButton Name="BackButton" Icon="Back" Label="后退" Click="BackButton_Click"/>
                            <AppBarButton Name="HomeButton" Icon="Home" Label="回到根目录" Click="HomeButton_Click"/>
                            <AppBarButton Name="CreateFolderButton" Icon="NewFolder" Label="新建文件夹">
                                <AppBarButton.Flyout>
                                    <Flyout x:Name="CreateFolderFlyout" Opened="Flyout_Opened">
                                        <Grid Name="CreateFolderFlyoutGrid" MinHeight="100" MinWidth="300">
                                            
                                        </Grid>
                                    </Flyout>
                                </AppBarButton.Flyout>
                            </AppBarButton>
                        </CommandBar.PrimaryCommands>
                    </CommandBar>
                </CommandBar.Content>
            </CommandBar>
        </Grid>
        <ProgressBar Grid.Row="1" Name="LoadingProgressBar" Visibility="Collapsed" IsIndeterminate="True" VerticalAlignment="Top"/>
        <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Grid.Row="2">
            <TextBlock Text="此文件夹为空。" Visibility="Collapsed" Name="EmptyFolderTip" HorizontalAlignment="Center" Margin="8"/>
            <ListView Name="lvFiles" SelectionMode="Extended" SelectionChanged="OnSelectionChanged" IsMultiSelectCheckBoxEnabled="True" ItemClick="lvFiles_ItemClick" IsItemClickEnabled="True" RightTapped="lvFiles_RightTapped">
                <ListView.ContextFlyout>
                    <MenuFlyout x:Name="ListViewFlyout" Opened="ListViewFlyout_Opened">
                        <MenuFlyoutItem Text="打开" Name="ListViewFlyout_Open" Click="ListViewFlyout_Open_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE8AD;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem Name="ListViewFlyout_OpenFilePath" Click="ListViewFlyout_OpenFilePath_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xED25;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem Text="复制完整路径" Name="ListViewFlyout_CopyFilePath" Click="ListViewFlyout_CopyFilePath_Click">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE62F;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </ListView.ContextFlyout>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    </Style>
                </ListView.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:ViewStorageItem">
                        <Grid Height="180">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                            </Grid.RowDefinitions>
                            <Image Margin="4" Width="128" Height="128" Source="{x:Bind Icon}" x:Phase="1"/>
                            
                            <TextBlock Grid.Row="1" Margin="3" HorizontalTextAlignment="Center" VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="WrapWholeWords" MaxLines="2" TextTrimming="CharacterEllipsis" Text="{x:Bind Name}" x:Phase="0"/>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ListView>
        </Grid>
    </Grid>
</Page>
